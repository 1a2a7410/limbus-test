<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>관리자 페이지</title>
<style>
  body { font-family: sans-serif; padding: 10px; }
  h1 { font-size: 20px; }
  .item-card {
    display: inline-block;
    padding: 5px;
    margin: 4px;
    border: 1px solid #ccc;
    border-radius: 6px;
    text-align: center;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.1s;
  }
  .item-card img { width: 60px; height: 60px; object-fit: cover; display: block; margin: 0 auto 5px; }
  .item-card.selected {
    background-color: #ffe066; /* 더 눈에 띄는 노란색 */
    border-color: #ff8800;
    transform: scale(1.05);
  }
  .form-group { margin: 10px 0; }
  label { display: block; font-weight: bold; margin-bottom: 4px; }
  input, select, button { padding: 6px; width: 100%; box-sizing: border-box; }
  button { cursor: pointer; }
  .btn-primary { background: #007bff; color: white; border: none; }
  .btn-danger { background: #dc3545; color: white; border: none; }
  .btn-secondary { background: #6c757d; color: white; border: none; }
  .item-list { display: flex; flex-wrap: wrap; }
</style>
</head>
<body>

<h1>관리자 페이지</h1>

<div class="form-group">
  <label>비밀번호</label>
  <input type="password" id="admin-password">
  <button class="btn-primary" onclick="checkAuth()">로그인</button>
</div>

<div id="admin-section" style="display:none;">
  <h2>계정 추가</h2>
  <div class="form-group">
    <label>UID</label>
    <input type="text" id="uid">
  </div>
  <div class="form-group">
    <label>부가 설명</label>
    <input type="text" id="desc">
  </div>
  <div class="form-group">
    <label>판매 상태</label>
    <select id="status">
      <option value="판매중">판매중</option>
      <option value="판매완료">판매완료</option>
    </select>
  </div>
  <div class="form-group">
    <label>가격</label>
    <input type="number" id="price">
  </div>
  <div class="form-group">
    <label>포함 아이템</label>
    <div id="item-list" class="item-list"></div>
  </div>
  <button class="btn-primary" onclick="addAccount()">계정 추가</button>
  <h2>계정 삭제</h2>
  <div class="form-group">
    <label>삭제할 UID</label>
    <input type="text" id="delete-uid">
  </div>
  <button class="btn-danger" onclick="deleteAccount()">계정 삭제</button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzUqwzXC4ORsHjYZ_ENyroHXz2G41e0ENMvEiUOreCuiYhnT56f48tSMJmQzbC162rPGA/exec";
let ADMIN_SECRET = "";

function checkAuth(){
  const pw = document.getElementById('admin-password').value;
  fetch(API_URL, {
    method: 'POST',
    body: JSON.stringify({ type: 'auth_check', secret: pw })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.ok){
      ADMIN_SECRET = pw;
      document.getElementById('admin-section').style.display = 'block';
      loadItems();
    } else {
      alert("비밀번호 오류");
    }
  });
}

function loadItems(){
  fetch(API_URL + "?sheet=items")
    .then(r=>r.json())
    .then(items=>{
      const list = document.getElementById('item-list');
      list.innerHTML = '';
      items.forEach(item=>{
        const div = document.createElement('div');
        div.className = 'item-card';
        div.innerHTML = `<img src="${item['이미지URL']}" alt=""><span>${item['아이템명']}</span>`;
        div.onclick = ()=> div.classList.toggle('selected');
        list.appendChild(div);
      });
    });
}

function addAccount(){
  const uid = document.getElementById('uid').value;
  const desc = document.getElementById('desc').value;
  const status = document.getElementById('status').value;
  const price = document.getElementById('price').value;
  const selectedItems = Array.from(document.querySelectorAll('.item-card.selected'))
        .map(div => div.querySelector('span').innerText);

  fetch(API_URL, {
    method: 'POST',
    body: JSON.stringify({
      type: 'account_upsert',
      secret: ADMIN_SECRET,
      data: { UID: uid, desc, status, price, items: selectedItems }
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.ok){
      alert("계정 추가 완료");
    } else {
      alert("오류: " + res.error);
    }
  });
}

function deleteAccount(){
  const uid = document.getElementById('delete-uid').value;
  fetch(API_URL, {
    method: 'POST',
    body: JSON.stringify({
      type: 'account_delete',
      secret: ADMIN_SECRET,
      data: { uid }
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.ok){
      alert("계정 삭제 완료");
    } else {
      alert("오류: " + res.error);
    }
  });
}
</script>

</body>
</html>