<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>관리자 페이지</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { font-size: 22px; }
    .input-group { margin-bottom: 10px; }
    label { display: inline-block; width: 100px; font-weight: bold; }
    input, textarea, select { padding: 5px; margin-right: 10px; }
    button { padding: 6px 12px; margin: 5px; cursor: pointer; border: none; border-radius: 4px; }
    .btn-primary { background-color: #007bff; color: white; }
    .btn-danger { background-color: #dc3545; color: white; }
    .btn-secondary { background-color: #6c757d; color: white; }
    #log { border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: scroll; background: #f9f9f9; }
    .log-entry { margin-bottom: 5px; }
    .log-time { color: #888; font-size: 12px; margin-right: 5px; }
    .log-success { color: green; }
    .log-error { color: red; }
</style>
</head>
<body>

<h1>관리자 페이지</h1>

<div class="input-group">
    <label>비밀번호</label>
    <input type="password" id="adminSecret">
    <button class="btn-primary" onclick="authCheck()">인증</button>
</div>

<h2>아이템 추가</h2>
<div class="input-group">
    <label>아이템명</label>
    <input type="text" id="itemName">
</div>
<div class="input-group">
    <label>이미지</label>
    <input type="file" id="itemImage">
</div>
<button class="btn-primary" onclick="uploadItem()">아이템 업로드</button>

<h2>계정 추가</h2>
<div class="input-group">
    <label>UID</label>
    <input type="text" id="uid">
</div>
<div class="input-group">
    <label>설명</label>
    <textarea id="desc"></textarea>
</div>
<div class="input-group">
    <label>판매상태</label>
    <select id="status">
        <option value="판매중">판매중</option>
        <option value="판매완료">판매완료</option>
    </select>
</div>
<div class="input-group">
    <label>가격</label>
    <input type="number" id="price">
</div>
<div class="input-group">
    <label>포함아이템</label>
    <input type="text" id="items" placeholder="콤마로 구분">
</div>
<button class="btn-primary" onclick="upsertAccount()">계정 저장</button>

<h2>계정 삭제</h2>
<div class="input-group">
    <label>UID</label>
    <input type="text" id="deleteUid">
</div>
<button class="btn-danger" onclick="deleteAccount()">계정 삭제</button>

<h2>로그</h2>
<div id="log"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzUqwzXC4ORsHjYZ_ENyroHXz2G41e0ENMvEiUOreCuiYhnT56f48tSMJmQzbC162rPGA/exec";
let adminSecret = "";

// 로그 함수
function log(message, type = "success") {
    const logDiv = document.getElementById("log");
    const time = new Date().toLocaleTimeString();
    const entry = document.createElement("div");
    entry.className = "log-entry";
    entry.innerHTML = `<span class="log-time">${time}</span><span class="log-${type}">${message}</span>`;
    logDiv.appendChild(entry);
    logDiv.scrollTop = logDiv.scrollHeight;
}

// 인증 확인
function authCheck() {
    adminSecret = document.getElementById("adminSecret").value;
    fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ type: "auth_check", secret: adminSecret })
    })
    .then(res => res.json())
    .then(data => {
        if (data.ok) {
            log("인증 성공", "success");
        } else {
            log("인증 실패", "error");
        }
    })
    .catch(() => log("네트워크 오류", "error"));
}

// 아이템 업로드
function uploadItem() {
    const name = document.getElementById("itemName").value;
    const file = document.getElementById("itemImage").files[0];
    if (!name || !file) {
        log("아이템명과 이미지를 입력하세요", "error");
        return;
    }
    const reader = new FileReader();
    reader.onload = function(e) {
        const base64 = e.target.result.split(",")[1];
        fetch(API_URL, {
            method: "POST",
            body: JSON.stringify({
                type: "item_upload",
                secret: adminSecret,
                data: { name, base64, mime: file.type, filename: file.name }
            })
        })
        .then(res => res.json())
        .then(data => {
            if (data.ok) {
                log(`아이템 '${name}' 업로드 성공`, "success");
            } else {
                log(`아이템 업로드 실패: ${data.error}`, "error");
            }
        })
        .catch(() => log("네트워크 오류", "error"));
    };
    reader.readAsDataURL(file);
}

// 계정 저장
function upsertAccount() {
    const UID = document.getElementById("uid").value;
    const desc = document.getElementById("desc").value;
    const status = document.getElementById("status").value;
    const price = parseInt(document.getElementById("price").value) || 0;
    const items = document.getElementById("items").value.split(",").map(s => s.trim());

    if (!UID) {
        log("UID를 입력하세요", "error");
        return;
    }

    fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({
            type: "account_upsert",
            secret: adminSecret,
            data: { UID, desc, status, price, items }
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.ok) {
            log(`계정 '${UID}' 저장 성공`, "success");
        } else {
            log(`계정 저장 실패: ${data.error}`, "error");
        }
    })
    .catch(() => log("네트워크 오류", "error"));
}

// 계정 삭제
function deleteAccount() {
    const uid = document.getElementById("deleteUid").value;
    if (!uid) {
        log("삭제할 UID를 입력하세요", "error");
        return;
    }
    fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({
            type: "account_delete",
            secret: adminSecret,
            data: { uid }
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.ok) {
            log(`계정 '${uid}' 삭제 성공`, "success");
        } else {
            log(`계정 삭제 실패: ${data.error}`, "error");
        }
    })
    .catch(() => log("네트워크 오류", "error"));
}
</script>

</body>
</html>